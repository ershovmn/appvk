(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{139:function(e,t,a){e.exports=a(182)},182:function(e,t,a){"use strict";a.r(t);a(140),a(165);var n=a(0),o=a.n(n),l=a(26),i=a.n(l),r=a(24),s=a.n(r),c=a(54),d=a.n(c),u=a(79),m=a(16),h=a(17),p=a(20),f=a(18),g=a(19),y=a(4),v=(a(181),a(22)),k=a(91),b=a.n(k),E=a(92),C=a.n(E),S=a(93),w=a.n(S),O=a(94),j=a.n(O),M=a(95),A=a.n(M),P=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).state={fetchedUser:null},e}return Object(g.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;s.a.subscribe(function(t){switch(t.detail.type){case"VKWebAppGetUserInfoResult":e.setState({fetchedUser:t.detail.data});break;default:console.log(t.detail.type)}}),s.a.send("VKWebAppGetUserInfo",{})}},{key:"render",value:function(){return console.log(localStorage.getItem("mapState")),o.a.createElement("div",null,o.a.createElement(y.r,null,"Settings"),this.state.fetchedUser&&o.a.createElement(y.h,{title:"User Data Fetched with VK Connect"},o.a.createElement(y.l,{before:this.state.fetchedUser.photo_200?o.a.createElement(y.b,{src:this.state.fetchedUser.photo_200}):null,description:this.state.fetchedUser.city&&this.state.fetchedUser.city.title?this.state.fetchedUser.city.title:""},"".concat(this.state.fetchedUser.first_name," ").concat(this.state.fetchedUser.last_name))),o.a.createElement(y.h,null,o.a.createElement(y.d,{onClick:console.log("tap"),"data-to":"tinder"},"Tinder"),o.a.createElement(y.d,{onClick:console.log("tap"),"data-to":"tinder"},"Tinder")))}}]),t}(o.a.Component),x=a(28),R=a(56),L=a.n(R),U=a(96),_=a.n(U),q=a(42),I=a.n(q),T=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(p.a)(this,Object(f.a)(t).call(this,e))).restaurants=[{coord:[55.7,37.6],code:0,id:12345},{coord:[55.7,37.61],code:1,id:82936},{coord:[55.7,37.62],code:2,id:12761},{coord:[55.5,37.6],code:0,id:18235},{coord:[55.8,37.31],code:1,id:11813},{coord:[55.5,36.92],code:2,id:16381},{coord:[55.9,35.6],code:0,id:12936}],a.map=null,a.rest=[{name:"Macdonalds",id:0,url:"https://www.pinclipart.com/picdir/middle/113-1137531_mcdonalds-logo-transparent-png-mcdonalds-logo-png-clipart.png"},{name:"KFC",id:1,url:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjI-yxfVTMbNT6ogrdOVoKeaL3UG5zbtgWLWPZqtBs8yGJbWx9"},{name:"BurgerKing",id:2,url:"https://cdn.imgbin.com/12/7/6/imgbin-hamburger-whopper-french-fries-burger-king-chicken-sandwich-burger-king-kGm4a8Unj0yht3gTpGYpkHedg.jpg"}],a.foodCourts=[{coord:[56,37.6],restaurants:[0,1,2],id:1243},{coord:[56.2,37.6],restaurants:[0,1,2],id:4357}],a.onBoundsChange=function(){try{a.setState({map:{center:a.map.getCenter(),zoom:a.map.getZoom()}})}catch(e){}},a.onKeyPressed=function(e){console.log(e),"Enter"===e.key&&"block"===a.state.displayList&&(console.log("hi"),a.setState({displayMap:"block",displayList:"none"}))},a.state={activePanel:"map",restaurants:a.restaurants,map:{center:[56,37.6],zoom:14},id:e.id,mode:"all",contextOpened:!1,switchRest:[!0,!0,!0],rest:a.rest,foodCourts:a.foodCourts,go:a.props.go,modals:{activeModal:null,modalHistory:[],data:{type:null,id:null,title:null}},search:"",displayMap:"block",displayList:"none"},a.switchClick=a.switchClick.bind(Object(v.a)(Object(v.a)(a))),a.openModal=a.openModal.bind(Object(v.a)(Object(v.a)(a))),a.modalBack=function(){a.setActiveModal(a.state.modals.modalHistory[a.state.modals.modalHistory.length-2])},a}return Object(g.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=localStorage.getItem("mapState");console.log(e);var t=[0,0];if(navigator.geolocation.getCurrentPosition(function(e){t=[e.coords.latitude,e.coords.longitude]}),null!==e){var a=(n=JSON.parse(e)).switchRest;null===n.map?(console.log(a),n={map:{center:t,switchRest:a}},this.setState(n)):this.setState(n)}else{var n={map:{center:t,zoom:14}};this.setState(n)}}},{key:"componentDidUpdate",value:function(){var e={map:this.state.map,switchRest:this.state.switchRest};localStorage.setItem("mapState",JSON.stringify(e))}},{key:"switchClick",value:function(e){var t=Number(e.currentTarget.dataset.mode),a=this.state.switchRest;a[t]=!a[t],this.setState({switchRest:a}),console.log(this.state)}},{key:"openModal",value:function(e){console.log(e),this.setState({modals:{data:e,activeModal:e.type}})}},{key:"setActiveModal",value:function(e){e=e||null,this.setState({modals:{activeModal:e,data:this.state.modals.data}})}},{key:"render",value:function(){var e=this;console.log(this.state);var t=o.a.createElement(y.p,{activeModal:this.state.modals.activeModal},o.a.createElement(y.m,{id:"restModalCard",onClose:function(){return e.setActiveModal(null)},title:this.state.modals.data.title,caption:String(this.state.modals.data.id),actions:[{title:"\u041c\u0435\u043d\u044e",type:"primary",action:function(){e.setActiveModal(null),e.setState({activePanel:"testmap"})}}]}),o.a.createElement(y.n,{id:"foodcourtModalPage",onClose:function(){return e.setActiveModal(null)},header:o.a.createElement(y.o,{right:o.a.createElement(y.i,{onClick:function(){return e.setActiveModal(null)}},Object(y.A)()===y.j?"\u0413\u043e\u0442\u043e\u0432\u043e":o.a.createElement(L.a,null))},this.state.modals.data.title)},o.a.createElement(y.k,null,o.a.createElement(y.c,{key:"1",onClick:function(){return console.log("click foodcourt")}},"Food Court"))),o.a.createElement(y.n,{id:"filter",onClose:function(){return e.setActiveModal(null)},header:o.a.createElement(y.o,{right:o.a.createElement(y.i,{onClick:function(){return e.setActiveModal(null)}},Object(y.A)()===y.j?"\u0413\u043e\u0442\u043e\u0432\u043e":o.a.createElement(L.a,null))},"\u0424\u0438\u043b\u044c\u0442\u0440\u044b")},o.a.createElement(y.k,null,this.state.rest.map(function(t,a){return e.state.switchRest[a]?o.a.createElement(y.c,{key:a,asideContent:o.a.createElement(y.u,{defaultChecked:!0,onClick:e.switchClick,"data-mode":t.id})},t.name):o.a.createElement(y.c,{key:a,asideContent:o.a.createElement(y.u,{onClick:e.switchClick,"data-mode":t.id})},t.name)}))));return o.a.createElement(y.z,{header:!1,activePanel:this.state.activePanel,modal:t},o.a.createElement(y.z,{id:"testmap",activePanel:"testmap"},o.a.createElement(y.q,{id:"testmap"},o.a.createElement(y.r,{left:o.a.createElement(y.i,{onClick:function(){return e.setState({activePanel:"map"})}},Object(y.A)()===y.j?o.a.createElement(_.a,null):o.a.createElement(I.a,null))},"Test"))),o.a.createElement(y.q,{id:"map",style:{overflow:"hidden"}},o.a.createElement(y.t,{id:"search",value:this.state.search,onChange:function(t){return e.setState({search:t})},onFocus:function(){return e.setState({displayMap:"none",displayList:"block"})},onBlur:function(){return e.setState({displayMap:"block",displayList:"none"})},onKeyDown:this.onKeyPressed,tabIndex:"0"}),o.a.createElement("div",{style:{display:this.state.displayList}},o.a.createElement(y.k,null,this.state.restaurants.map(function(t,a){var n=e.state.rest[t.code].name.toLowerCase(),l=e.state.search.toLowerCase();return-1===n.indexOf(l)?null:o.a.createElement(y.c,{key:a},e.state.rest[t.code].name)}))),o.a.createElement("div",{style:{width:"100%",height:"calc(100vh - 92px)",display:this.state.displayMap,overflow:"hidden"}},o.a.createElement(x.e,null,o.a.createElement(x.c,{width:"100%",height:"100%",state:{center:this.state.map.center,zoom:this.state.map.zoom},instanceRef:function(t){return e.map=t},onBoundsChange:this.onBoundsChange,options:{restrictMapArea:[[60.056,29.511],[50.056,37.829]]}},o.a.createElement(x.b,null),o.a.createElement(x.a,{options:{preset:"islands#invertedVioletClusterIcons"}},this.state.restaurants.map(function(t,a){var n=e.state.rest[t.code].name.toLowerCase(),l=e.state.search.toLowerCase();return e.state.switchRest[t.code]&&-1!==n.indexOf(l)||-1!==n.indexOf(l)&&""!==l?o.a.createElement(x.d,{key:a,onClick:function(){e.openModal({type:"restModalCard",title:e.state.rest[t.code].name,id:t.id})},geometry:t.coord,properties:{iconContent:e.state.rest[t.code].name[0]},options:{preset:"islands#orangeIcon"}}):null}),this.state.foodCourts.map(function(t,a){var n=0;t.restaurants.forEach(function(t){var a=e.state.rest[t].name.toLowerCase(),o=e.state.search.toLowerCase();(e.state.switchRest[t]&&-1!==a.indexOf(o)||-1!==a.indexOf(o)&&""!==o)&&(n+=1)});var l=e.state.restaurants.length;return 0===n?null:o.a.createElement(x.d,{key:l+a,geometry:t.coord,properties:{iconContent:n},options:{preset:"islands#orangeIcon"},onClick:function(){e.openModal({type:"foodcourtModalPage",id:t.id,title:"foodcourt"})}})})))),o.a.createElement("div",{style:{position:"fixed",bottom:"50px",right:"10px"}},o.a.createElement("img",{src:"http://about-telegram.ru/wp-content/uploads/2018/03/kot-persik-stickers-telegram_21.png",style:{height:"75px"},onClick:function(){return e.setActiveModal("filter")}})))))}}]),t}(o.a.Component),z=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).state={activeModal:"modalRoot"},e}return Object(g.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(y.z,{id:this.props.id,activePanel:"tinderRoot",modal:o.a.createElement(y.p,{activeModal:this.state.activeModal},o.a.createElement(y.m,{id:"modalRoot",onClose:function(){return e.setState({activeModal:null})},title:"test",actions:[{title:"push",type:"primary",action:function(){return console.log("test")}}]}))},o.a.createElement(y.q,{id:"tinderRotot"},o.a.createElement(y.r,null,"Tinder")))}}]),t}(o.a.Component),K=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(p.a)(this,Object(f.a)(t).call(this,e))).flag_name=!0,a.viewChange=function(e){a.setState({activeStory:e})},a.state={id:e.id,activeStory:"map",activePanel:"epic",idRest:null},a.onStoryChange=a.onStoryChange.bind(Object(v.a)(Object(v.a)(a))),a}return Object(g.a)(t,e),Object(h.a)(t,[{key:"onStoryChange",value:function(e){this.setState({activeStory:e.currentTarget.dataset.story})}},{key:"render",value:function(){return o.a.createElement(y.e,{id:"epic",activeStory:this.state.activeStory,tabbar:o.a.createElement(y.v,null,o.a.createElement(y.w,{key:"map",onClick:this.onStoryChange,selected:"map"===this.state.activeStory,"data-story":"map",text:this.flag_name?"Map":null},o.a.createElement(b.a,null)),o.a.createElement(y.w,{key:"quick",onClick:this.onStoryChange,selected:"quick"===this.state.activeStory,"data-story":"quick",text:this.flag_name?"Quick":null},o.a.createElement(C.a,null)," "),o.a.createElement(y.w,{key:"tinder",onClick:this.onStoryChange,selected:"tinder"===this.state.activeStory,"data-story":"tinder",text:this.flag_name?"Tinder":null},o.a.createElement(j.a,null)," "),o.a.createElement(y.w,{key:"basket",onClick:this.onStoryChange,selected:"basket"===this.state.activeStory,"data-story":"basket",text:this.flag_name&&"basket"},o.a.createElement(A.a,null)),o.a.createElement(y.w,{key:"settings",onClick:this.onStoryChange,selected:"settings"===this.state.activeStory,"data-story":"settings",text:this.flag_name?"Settings":null},o.a.createElement(w.a,null)," "))},o.a.createElement(T,{id:"map",viewChange:this.viewChange}),o.a.createElement(y.z,{id:"quick",activePanel:"quick"},o.a.createElement(y.q,{id:"quick"},o.a.createElement(y.r,null,"Quick"),"Quick")),o.a.createElement(z,{id:"tinder"}),o.a.createElement(y.z,{id:"settings",activePanel:"settings"},o.a.createElement(y.q,{id:"settings"},o.a.createElement(P,null))),o.a.createElement(y.z,{id:"basket",activePanel:"basket"},o.a.createElement(y.q,{id:"basket"},"Basket")))}}]),t}(o.a.Component),V=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).state={},e}return Object(g.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement(y.z,{header:!1,activePanel:"main"},o.a.createElement(y.q,{id:"main"},o.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},o.a.createElement("div",{style:{height:"200px",width:"100%",display:"block"}},o.a.createElement(y.g,{slideWidth:"100%",style:{height:"100%",width:"100%"},bullets:"dark"},o.a.createElement("div",null,"Hello"),o.a.createElement("div",null,"Hi"),o.a.createElement("div",null,"H")))),o.a.createElement(y.f,{vertical:"bottom"},o.a.createElement(y.x,null,o.a.createElement(y.y,{onClick:this.props.closeThis},"\u041d\u0430\u0447\u0430\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c")))))}}]),t}(o.a.Component),G=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(p.a)(this,Object(f.a)(t).call(this,e))).allertPopout=function(){return a.setState({errorAuth:!0}),o.a.createElement(y.a,{actions:[{title:"Ok",autoclose:!0,style:"default"}],onClose:a.closePopout},o.a.createElement("h2",null,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438"),o.a.createElement("h2",null,"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443 \u043f\u043e\u0437\u0436\u0435"))},a.closePopout=function(){console.log("test"),a.setState({popout:o.a.createElement(y.s,null)})},a.state={activePanel:"black",fetchedUser:null,token:null,mytoken:null,popout:o.a.createElement(y.s,null),test:"fail",firstLogin:!1,errorAuth:!1},a}return Object(g.a)(t,e),Object(h.a)(t,[{key:"tryGet",value:function(){var e=Object(u.a)(d.a.mark(function e(t){var a=this;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:fetch("http://192.168.43.244:3000/api/v1/users/from_vk_token?token="+t,{method:"GET"}).then(function(e){return e.json()}).then(function(e){localStorage.setItem("token",e.token),a.setState({token:t,mytoken:e.token,activePanel:"start",popout:null,errorAuth:!1})});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("mapState");null!==t&&(t={switchRest:(t=JSON.parse(t)).switchRest,map:null},localStorage.setItem("mapState",JSON.stringify(t))),s.a.send("VKWebAppGetAuthToken",{app_id:7150406,scope:""});var a=null;s.a.subscribe(function(t){switch(t.detail.type){case"VKWebAppAccessTokenReceived":a=t.detail.data.access_token,e.tryGet(a),setTimeout(e.setState({errorAuth:!0}),5e4);break;case"VKWebAppAccessTokenFailed":console.log("error connect Vk"),e.setState({errorAuth:!0})}})}},{key:"render",value:function(){var e=this;console.log(this.state);try{return this.state.errorAuth?(console.log("errorAuth"),o.a.createElement(y.z,{header:!1,activePanel:"error"},o.a.createElement(y.q,{id:"error"},"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438"))):this.state.firstLogin?(console.log("firstLogin"),o.a.createElement(V,{closeThis:function(){return e.setState({firstLogin:!1})}})):o.a.createElement(K,{id:"start"})}catch(t){return o.a.createElement(y.z,{activePanel:"bug"},o.a.createElement(y.q,{id:"bug"},"\u042d\u0442\u043e \u043d\u0435 \u0431\u0430\u0433, \u044d\u0442\u043e \u0444\u0438\u0447\u0430"))}}}]),t}(o.a.Component);s.a.subscribe(function(e){switch(e.detail.type){case"VKWebAppUpdateConfig":var t=document.createAttribute("scheme");t.value=e.detail.data.scheme?e.detail.data.scheme:"client_light",t.value="client_dark",document.body.attributes.setNamedItem(t);break;default:console.log(e.detail.type)}}),s.a.send("VKWebAppInit",{}),i.a.render(o.a.createElement(G,null),document.getElementById("root"))}},[[139,1,2]]]);
//# sourceMappingURL=main.de311ee9.chunk.js.map